## Deployment (Coolify process)

> Pipeline process [here](https://github.com/nansphilip/EcoService/tree/main/.github/ci-cd-workflows.md)

1. Create a `Mysql` environnment:

- Name: `Eco Service (database)`
- Normal User: `eco-service-user`
- Initial Database: `eco-service-db`
- Save and start the environnment

2. Go to the online terminal tab

- Login with the password generated by Coolify

```bash
mysql -u eco-service-user -p <generated-root-password>
```

- Add grant to the user on the database to allow Prisma to connect to the database.

```sql
GRANT ALL PRIVILEGES ON *.* TO 'eco-service-user'@'%';
```

3. Create a `Node.js` environnment:

- Name: `Eco Service (main)`
- Domain: `eco-service.domain.com`

- Install Command

```bash
pnpm install && pnpm prisma:generate && pnpm prisma:deploy
```

- Build Command

```bash
pnpm run build && pnpm install --prod
```

- Start Command

```bash
pnpm run start
```

- Save configuration

4. Add environment variables

```env
NEXT_PUBLIC_BASE_URL=https://eco-service.domain.com

# Database connection (get it in the Mysql environnment)
DATABASE_URL=mysql://eco-service-user: ******** @ ******** /eco-service-db

# Mysql root password (optional, use in script/db.ts)
MYSQL_ROOT_PASSWORD= ********

# Better Auth encryption key (generate a random string)
BETTER_AUTH_SECRET=session-encryption-key

# Plunk keys (get it in the Plunk dashboard)
PLUNK_API_KEY=plunk-private-key

# Stripe keys (get it in the Stripe dashboard)
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_xxxxx
STRIPE_SECRET_KEY=sk_test_pk_test_xxxxx
STRIPE_WEBHOOK_SECRET=whsec_xxxxx
```

- Save variables and start the environnment
